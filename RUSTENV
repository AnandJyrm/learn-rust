export RUSTUP_HOME=$PWD/rust-bin
export CARGO_HOME=$PWD/rust-bin

deactivate () {
    unset RUSTUP_HOME
    unset CARGO_HOME
    if [ -n "${_OLD_VIRTUAL_PS1:-}" ] ; then
        PS1="${_OLD_VIRTUAL_PS1:-}"
        export PS1
        unset _OLD_VIRTUAL_PS1
    fi

    # restore old protoc env
    if [ -n "${_OLD_PROTOC}" ] ; then
        export PROTOC="${_OLD_PROTOC}"
        unset _OLD_PROTOC
    fi
    unset -f deactivate
}

source $PWD/rust-bin/env

# preserve old prompt
_OLD_VIRTUAL_PS1="${PS1:-}"
export PS1="(RUSTENV) ${PS1:-}"

# preserve old protoc env
_OLD_PROTOC="${PROTOC}"
export PROTOC=/usr/bin/protoc